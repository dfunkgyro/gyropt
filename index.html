<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GyroTechPro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0a0a12;
      --secondary: #12121a;
      --accent: #00d9ff;
      --accent-glow: rgba(0, 217, 255, 0.4);
      --text: #e0e0e0;
      --text-dim: #a0a0b0;
      --glass-bg: rgba(20, 20, 30, 0.4);
      --glass-border: rgba(255, 255, 255, 0.1);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --chat-bg: rgba(10, 10, 18, 0.95);
      --chat-border: rgba(255, 255, 255, 0.15);
      --font-size-base: 16px;
      --border-radius: 20px;
      --animation-speed: 0.4s;
      --z-gallery: 1;
      --z-controls: 100;
      --z-chat: 900;
      --z-modal: 1000;
      --z-toast: 1100;
    }

    /* Theme variations */
    .theme-dark {
      --primary: #000000;
      --secondary: #0a0a0a;
      --accent: #ff0080;
      --accent-glow: rgba(255, 0, 128, 0.4);
    }

    .theme-light {
      --primary: #ffffff;
      --secondary: #f0f0f0;
      --text: #1a1a1a;
      --text-dim: #666666;
      --glass-bg: rgba(255, 255, 255, 0.3);
      --glass-border: rgba(0, 0, 0, 0.1);
      --chat-bg: rgba(255, 255, 255, 0.95);
      --chat-border: rgba(0, 0, 0, 0.15);
    }

    .theme-cyberpunk {
      --primary: #00171a;
      --secondary: #330800;
      --accent: #ff8800;
      --accent-glow: rgba(255, 255, 255, 0.6);
      --glass-bg: rgba(0, 255, 170, 0.1);
    }

    .theme-ocean {
      --primary: #001122;
      --secondary: #002244;
      --accent: #00ffaa;
      --accent-glow: rgba(0, 255, 170, 0.4);
    }

    .theme-neon-green {
      --primary: #001100;
      --secondary: #002200;
      --accent: #00ff00;
      --accent-glow: rgba(0, 255, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      font-size: var(--font-size-base);
      transition: all var(--animation-speed) ease;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 80%, var(--accent-glow) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(120, 0, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 0, 200, 0.05) 0%, transparent 50%);
      z-index: -1;
      transition: all var(--animation-speed) ease;
    }

    /* Fixed Header */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      padding: 1rem 2rem;
      z-index: var(--z-controls);
      transition: all var(--animation-speed) ease;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 300;
      letter-spacing: 1px;
      background: linear-gradient(90deg, var(--text), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .header-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Search and Filter Controls */
    .search-container {
      position: relative;
      min-width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 1px solid var(--glass-border);
      border-radius: 25px;
      background: var(--glass-bg);
      color: var(--text);
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-dim);
    }

    .category-filter {
      padding: 0.75rem 1rem;
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      background: var(--glass-bg);
      color: var(--text);
      outline: none;
      cursor: pointer;
      min-width: 150px;
      backdrop-filter: blur(10px);
    }

    .view-toggle {
      display: flex;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .view-btn {
      padding: 0.75rem 1rem;
      border: none;
      background: transparent;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .view-btn.active {
      background: var(--accent);
      color: #000;
    }

    /* Theme selector */
    .theme-selector {
      display: flex;
      gap: 0.5rem;
      background: var(--glass-bg);
      padding: 0.5rem;
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }

    .theme-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .theme-btn:hover, .theme-btn.active {
      transform: scale(1.1);
      border-color: var(--accent);
    }

    .theme-btn.neon { background: linear-gradient(135deg, #00d9ff, #7000ff); }
    .theme-btn.dark { background: linear-gradient(135deg, #ff0080, #000000); }
    .theme-btn.light { background: linear-gradient(135deg, #ffffff, #f0f0f0); }
    .theme-btn.cyberpunk { background: linear-gradient(135deg, #00161a, #001a14); }
    .theme-btn.ocean { background: linear-gradient(135deg, #00ffaa, #001122); }
    .theme-btn.neon-green { background: linear-gradient(135deg, #00ff00, #001100); }

    /* Main content with scroll */
    .main-content {
      margin-top: 100px;
      padding: 2rem;
      min-height: calc(100vh - 100px);
    }

    .intro-section {
      text-align: center;
      margin-bottom: 3rem;
    }

    .intro-section h1 {
      font-size: calc(2rem + 1vw);
      font-weight: 300;
      letter-spacing: 2px;
      margin-bottom: 1rem;
      background: linear-gradient(90deg, var(--text), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px var(--accent-glow);
    }

    .intro-section p {
      color: var(--text-dim);
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto;
    }

    /* Category sections */
    .category-section {
      margin-bottom: 4rem;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.8s ease forwards;
    }

    .category-header {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--glass-border);
    }

    .category-icon {
      font-size: 2rem;
      margin-right: 1rem;
      color: var(--accent);
    }

    .category-title {
      font-size: 1.8rem;
      font-weight: 400;
      color: var(--text);
    }

    .category-count {
      margin-left: auto;
      background: var(--accent-glow);
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      font-size: 0.9rem;
      color: var(--text);
    }

    /* Gallery grid */
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
      transition: all var(--animation-speed) ease;
    }

    .gallery.list-view {
      grid-template-columns: 1fr;
    }

    .gallery.compact-view {
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
    }

    /* Card styles */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--glass-shadow);
      transition: all var(--animation-speed) cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.6s ease forwards;
      z-index: var(--z-gallery);
    }

    .card.hidden {
      display: none;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
      z-index: 1;
      pointer-events: none;
      opacity: 0;
      transition: all var(--animation-speed) ease;
    }

    .card:hover {
      transform: translateY(-10px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px var(--accent-glow);
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      position: relative;
      z-index: 2;
    }

    .card-image {
      position: relative;
      width: 100%;
      height: 180px;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--accent-glow), rgba(120, 0, 255, 0.1));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .card:hover .card-image img {
      transform: scale(1.05);
    }

    .favorite-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 3;
    }

    .favorite-btn:hover,
    .favorite-btn.active {
      color: #ff6b6b;
      transform: scale(1.1);
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .tag {
      padding: 0.3rem 0.8rem;
      background: var(--accent-glow);
      border-radius: 15px;
      font-size: 0.8rem;
      color: var(--text);
    }

    .card h3 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
      position: relative;
      z-index: 2;
    }

    .card p {
      color: var(--text-dim);
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
      line-height: 1.6;
      position: relative;
      z-index: 2;
    }

    .card-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      font-size: 0.8rem;
      color: var(--text-dim);
      position: relative;
      z-index: 2;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .links {
      display: flex;
      gap: 1rem;
      position: relative;
      z-index: 2;
    }

    .links a {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.8rem 1rem;
      border-radius: 10px;
      text-decoration: none;
      color: var(--text);
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      background: var(--accent-glow);
      border: 1px solid rgba(0, 217, 255, 0.3);
    }

    .links a:hover {
      background: var(--accent);
      color: #000;
      box-shadow: 0 0 15px var(--accent-glow);
      transform: translateY(-2px);
    }

    /* Chat Interface - Enhanced */
    .chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: var(--z-chat);
    }

    .chat-toggle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #7000ff);
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px var(--accent-glow);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .chat-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px var(--accent-glow);
    }

    .chat-notification {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 20px;
      height: 20px;
      background: #ff4757;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
      animation: pulse 2s infinite;
    }

    .chat-window {
      position: absolute;
      bottom: 80px;
      right: 0;
      width: 380px;
      height: 550px;
      background: var(--chat-bg);
      backdrop-filter: blur(30px);
      border: 1px solid var(--chat-border);
      border-radius: 20px;
      display: none;
      flex-direction: column;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.4),
        0 0 0 1px var(--accent-glow);
      overflow: hidden;
    }

    .chat-window.active {
      display: flex;
      animation: slideInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .chat-header {
      padding: 20px;
      border-bottom: 1px solid var(--chat-border);
      display: flex;
      align-items: center;
      gap: 15px;
      background: var(--glass-bg);
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #7000ff);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }

    .chat-status {
      flex: 1;
    }

    .chat-status h4 {
      margin: 0;
      color: var(--text);
    }

    .chat-status p {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-dim);
    }

    .chat-actions {
      display: flex;
      gap: 10px;
    }

    .chat-action-btn {
      background: none;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .chat-action-btn:hover {
      color: var(--accent);
      background: var(--glass-bg);
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      scroll-behavior: smooth;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--accent-glow);
      border-radius: 10px;
    }

    .message {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 18px;
      word-wrap: break-word;
      animation: slideIn 0.3s ease;
      position: relative;
      line-height: 1.4;
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent), #0066cc);
      color: white;
      border-bottom-right-radius: 6px;
    }

    .message.ai {
      align-self: flex-start;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--text);
      border-bottom-left-radius: 6px;
      backdrop-filter: blur(10px);
    }

    .message-time {
      font-size: 0.7rem;
      opacity: 0.6;
      margin-top: 5px;
      text-align: right;
    }

    .message.ai .message-time {
      text-align: left;
    }

    .typing-indicator {
      display: none;
      padding: 12px 16px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      align-self: flex-start;
      max-width: 80px;
      backdrop-filter: blur(10px);
    }

    .typing-dots {
      display: flex;
      gap: 4px;
      justify-content: center;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      animation: typing 1.4s infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    .chat-input-container {
      padding: 20px;
      border-top: 1px solid var(--chat-border);
      background: var(--glass-bg);
    }

    .chat-input {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .input-wrapper {
      flex: 1;
      position: relative;
    }

    .chat-input input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--chat-border);
      border-radius: 20px;
      background: var(--glass-bg);
      color: var(--text);
      outline: none;
      transition: all 0.3s ease;
      resize: none;
      min-height: 44px;
      backdrop-filter: blur(10px);
    }

    .chat-input input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-glow);
    }

    .chat-input textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--chat-border);
      border-radius: 20px;
      background: var(--glass-bg);
      color: var(--text);
      outline: none;
      transition: all 0.3s ease;
      resize: none;
      min-height: 44px;
      max-height: 120px;
      font-family: inherit;
      backdrop-filter: blur(10px);
    }

    .send-btn {
      padding: 12px;
      border: none;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #0066cc);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px;
    }

    .send-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Quick actions */
    .quick-actions {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .quick-action {
      padding: 6px 12px;
      background: var(--glass-bg);
      border: 1px solid var(--chat-border);
      border-radius: 15px;
      font-size: 0.8rem;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .quick-action:hover {
      background: var(--accent-glow);
      color: var(--text);
      border-color: var(--accent);
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      top: 120px;
      right: 20px;
      z-index: var(--z-toast);
      pointer-events: none;
    }

    .toast {
      background: var(--chat-bg);
      backdrop-filter: blur(20px);
      color: var(--text);
      padding: 16px 20px;
      border-radius: 12px;
      border: 1px solid var(--chat-border);
      margin-bottom: 10px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      transform: translateX(100%);
      opacity: 0;
      animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      pointer-events: auto;
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 350px;
    }

    .toast.success { border-left: 4px solid #2ed573; }
    .toast.error { border-left: 4px solid #ff4757; }
    .toast.info { border-left: 4px solid var(--accent); }
    .toast.warning { border-left: 4px solid #ffa502; }

    .toast-icon {
      font-size: 1.2rem;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .toast-message {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }

    .toast-close:hover {
      color: var(--text);
      background: var(--glass-bg);
    }

    /* Loading states */
    .loading {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--glass-border);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* AI Status indicator */
    .ai-status {
      position: fixed;
      top: 120px;
      left: 20px;
      background: var(--chat-bg);
      backdrop-filter: blur(20px);
      padding: 12px 20px;
      border-radius: 25px;
      border: 1px solid var(--chat-border);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: var(--z-controls);
      transition: all var(--animation-speed) ease;
    }

    .ai-status.active {
      box-shadow: 0 0 20px var(--accent-glow);
    }

    .ai-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      animation: pulse 2s infinite;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Staggered animation delays */
    .card:nth-child(1) { animation-delay: 0.1s; }
    .card:nth-child(2) { animation-delay: 0.15s; }
    .card:nth-child(3) { animation-delay: 0.2s; }
    .card:nth-child(4) { animation-delay: 0.25s; }
    .card:nth-child(5) { animation-delay: 0.3s; }
    .card:nth-child(6) { animation-delay: 0.35s; }

    .category-section:nth-child(1) { animation-delay: 0.2s; }
    .category-section:nth-child(2) { animation-delay: 0.4s; }
    .category-section:nth-child(3) { animation-delay: 0.6s; }
    .category-section:nth-child(4) { animation-delay: 0.8s; }

    /* Responsive design */
    @media (max-width: 768px) {
      .fixed-header {
        padding: 1rem;
      }

      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .header-controls {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
      }

      .search-container {
        min-width: 250px;
        order: -1;
        width: 100%;
      }

      .main-content {
        margin-top: 160px;
        padding: 1rem;
      }

      .gallery {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .intro-section h1 {
        font-size: 2rem;
      }

      .intro-section p {
        font-size: 1rem;
      }

      .category-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .category-count {
        margin-left: 0;
      }

      .chat-window {
        width: calc(100vw - 40px);
        height: calc(100vh - 140px);
        bottom: 10px;
        right: 10px;
        left: 10px;
      }

      .card {
        padding: 1.25rem;
      }

      .links {
        flex-direction: column;
        gap: 0.75rem;
      }

      .ai-status {
        position: static;
        margin: 1rem;
        justify-content: center;
      }

      .theme-selector {
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .header-title {
        font-size: 1.2rem;
      }

      .category-title {
        font-size: 1.4rem;
      }

      .card h3 {
        font-size: 1.2rem;
      }

      .card p {
        font-size: 0.85rem;
      }

      .theme-btn {
        width: 25px;
        height: 25px;
      }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --glass-bg: rgba(0, 0, 0, 0.8);
        --glass-border: rgba(255, 255, 255, 0.3);
        --text-dim: #cccccc;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus indicators for accessibility */
    button:focus,
    input:focus,
    select:focus,
    .theme-btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Hidden elements for screen readers */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <!-- Fixed Header -->
  <header class="fixed-header">
    <div class="header-content">
      <h1 class="header-title">GyroTechPro</h1>
      <div class="header-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            class="search-input"
            placeholder="Search apps, categories, or features..."
            id="searchInput"
            aria-label="Search gallery items"
          >
        </div>
        <select class="category-filter" id="categoryFilter" aria-label="Filter by category">
          <option value="">All Categories</option>
          <option value="web-apps">Web Apps</option>
          <option value="mobile-apps">Mobile Apps</option>
          <option value="desktop-apps">Desktop Apps</option>
          <option value="games">Games</option>
          <option value="tools">Tools & Utilities</option>
          <option value="ai-ml">AI & Machine Learning</option>
        </select>
        <div class="view-toggle">
          <button class="view-btn active" data-view="grid" aria-label="Grid view">
            <i class="fas fa-th"></i>
          </button>
          <button class="view-btn" data-view="list" aria-label="List view">
            <i class="fas fa-list"></i>
          </button>
          <button class="view-btn" data-view="compact" aria-label="Compact view">
            <i class="fas fa-th-large"></i>
          </button>
        </div>
        <div class="theme-selector">
          <div class="theme-btn neon active" data-theme="default" title="Neon Theme" tabindex="0"></div>
          <div class="theme-btn dark" data-theme="theme-dark" title="Dark Theme" tabindex="0"></div>
          <div class="theme-btn light" data-theme="theme-light" title="Light Theme" tabindex="0"></div>
          <div class="theme-btn cyberpunk" data-theme="theme-cyberpunk" title="Cyberpunk Theme" tabindex="0"></div>
          <div class="theme-btn ocean" data-theme="theme-ocean" title="Ocean Theme" tabindex="0"></div>
          <div class="theme-btn neon-green" data-theme="theme-neon-green" title="Neon Green Theme" tabindex="0"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- AI Status Indicator -->
  <div class="ai-status" id="aiStatus">
    <div class="ai-status-dot"></div>
    <span>AI Agent Ready</span>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Main Content -->
  <main class="main-content">
    <section class="intro-section">
      <h1>GyroTechPro</h1>
      <p>Discover a curated collection of cutting-edge applications with personalization, intelligent categorization, and real-time customization features</p>
    </section>

    <!-- Web Applications Category -->
    <section class="category-section" data-category="web-apps">
      <div class="category-header">
        <i class="fas fa-globe category-icon"></i>
        <h2 class="category-title">Web Applications</h2>
        <span class="category-count">6 items</span>
      </div>
      <div class="gallery" id="webAppsGallery">
        <!-- Web apps will be populated by JavaScript -->
      </div>
    </section>

    <!-- Mobile Applications Category -->
    <section class="category-section" data-category="mobile-apps">
      <div class="category-header">
        <i class="fas fa-mobile-alt category-icon"></i>
        <h2 class="category-title">Mobile Applications</h2>
        <span class="category-count">5 items</span>
      </div>
      <div class="gallery" id="mobileAppsGallery">
        <!-- Mobile apps will be populated by JavaScript -->
      </div>
    </section>

    <!-- Desktop Applications Category -->
    <section class="category-section" data-category="desktop-apps">
      <div class="category-header">
        <i class="fas fa-desktop category-icon"></i>
        <h2 class="category-title">Desktop Applications</h2>
        <span class="category-count">4 items</span>
      </div>
      <div class="gallery" id="desktopAppsGallery">
        <!-- Desktop apps will be populated by JavaScript -->
      </div>
    </section>

    <!-- Games Category -->
    <section class="category-section" data-category="games">
      <div class="category-header">
        <i class="fas fa-gamepad category-icon"></i>
        <h2 class="category-title">Games</h2>
        <span class="category-count">3 items</span>
      </div>
      <div class="gallery" id="gamesGallery">
        <!-- Games will be populated by JavaScript -->
      </div>
    </section>

    <!-- Tools & Utilities Category -->
    <section class="category-section" data-category="tools">
      <div class="category-header">
        <i class="fas fa-tools category-icon"></i>
        <h2 class="category-title">Tools & Utilities</h2>
        <span class="category-count">4 items</span>
      </div>
      <div class="gallery" id="toolsGallery">
        <!-- Tools will be populated by JavaScript -->
      </div>
    </section>

    <!-- AI & Machine Learning Category -->
    <section class="category-section" data-category="ai-ml">
      <div class="category-header">
        <i class="fas fa-brain category-icon"></i>
        <h2 class="category-title">AI & Machine Learning</h2>
        <span class="category-count">3 items</span>
      </div>
      <div class="gallery" id="aiMlGallery">
        <!-- AI/ML apps will be populated by JavaScript -->
      </div>
    </section>
  </main>

  <!-- Enhanced Chat Interface -->
  <div class="chat-container">
    <button class="chat-toggle" onclick="toggleChat()" aria-label="Open AI chat assistant">
      <i class="fas fa-robot"></i>
      <div class="chat-notification" id="chatNotification">1</div>
    </button>

    <div class="chat-window" id="chatWindow" role="dialog" aria-label="AI Assistant Chat">
      <div class="chat-header">
        <div class="chat-avatar">
          <i class="fas fa-brain"></i>
        </div>
        <div class="chat-status">
          <h4>AI Gallery Assistant</h4>
          <p id="chatStatusText">Ready to help customize your experience</p>
        </div>
        <div class="chat-actions">
          <button class="chat-action-btn" onclick="clearChat()" title="Clear chat history">
            <i class="fas fa-trash"></i>
          </button>
          <button class="chat-action-btn" onclick="exportChat()" title="Export chat">
            <i class="fas fa-download"></i>
          </button>
          <button class="chat-action-btn" onclick="toggleChat()" title="Close chat">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="chat-messages" id="chatMessages" role="log" aria-label="Chat messages">
        <div class="message ai">
          <div class="message-content">
            üöÄ Welcome to GyroTechPro gallery! I can help you with:
            <br><br>
            üé® <strong>Themes & Styling:</strong> Change colors, fonts, layouts<br>
            üîç <strong>Smart Search:</strong> Find apps by features or category<br>
            ‚≠ê <strong>Recommendations:</strong> Suggest apps based on your interests<br>
            üéØ <strong>Customization:</strong> Personalize your browsing experience<br>
            üìä <strong>Analytics:</strong> Get insights about app usage and trends
          </div>
          <div class="message-time" id="welcomeTime"></div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="quick-actions" id="quickActions">
          <button class="quick-action" onclick="sendQuickMessage('Show me trending apps')">
            üìà Trending
          </button>
          <button class="quick-action" onclick="sendQuickMessage('Change theme to cyberpunk')">
            üåà Cyberpunk Theme
          </button>
          <button class="quick-action" onclick="sendQuickMessage('Recommend AI tools')">
            ü§ñ AI Tools
          </button>
          <button class="quick-action" onclick="sendQuickMessage('Search for games')">
            üéÆ Games
          </button>
        </div>

        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>

        <div class="chat-input">
          <div class="input-wrapper">
            <textarea
              id="chatInput"
              placeholder="Ask me to customize your experience, search for apps, or get recommendations..."
              maxlength="500"
              rows="1"
              aria-label="Chat message input"
            ></textarea>
          </div>
          <button class="send-btn" onclick="sendMessage()" id="sendButton" aria-label="Send message">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced AI Gallery Agent with comprehensive features
    class EnhancedAIGalleryAgent {
      constructor() {
        this.apiKey = localStorage.getItem('openai_api_key') || '';
        this.chatHistory = JSON.parse(localStorage.getItem('chat_history') || '[]');
        this.personalizations = JSON.parse(localStorage.getItem('gallery_personalizations') || '{}');
        this.favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        this.searchHistory = JSON.parse(localStorage.getItem('search_history') || '[]');
        this.usageStats = JSON.parse(localStorage.getItem('usage_stats') || '{}');

        this.isTyping = false;
        this.currentTheme = this.personalizations.theme || 'default';
        this.currentView = this.personalizations.view || 'grid';
        this.searchQuery = '';
        this.activeCategory = '';

        // Particle system
        this.particles = [];
        this.particlePool = [];
        this.maxParticles = 20;

        // Typing timeout
        this.typingTimeout = null;

        // Performance monitoring
        this.lastFrameTime = 0;
        this.frameCount = 0;

        this.init();
      }

      async init() {
        try {
          // Initialize UI components
          this.setupEventListeners();
          this.populateGallery();
          this.applyPersonalizations();
          this.loadChatHistory();
          this.updateWelcomeTime();
          this.startPerformanceMonitoring();

          // Initialize particle system with memory management
          this.initParticleSystem();

          // Track initial page load
          this.trackEvent('page_load', { timestamp: Date.now() });

          // Show welcome notification
          this.showToast('AI Assistant Ready!', 'Your personalized gallery experience is now active.', 'success');

        } catch (error) {
          console.error('Initialization error:', error);
          this.showToast('Initialization Error', 'Some features may not work properly.', 'error');
        }
      }

      setupEventListeners() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');

        // Debounce search input
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            this.handleSearch(e.target.value);
          }, 300);
        });

        categoryFilter.addEventListener('change', (e) => {
          this.handleCategoryFilter(e.target.value);
        });

        // View toggle
        document.querySelectorAll('.view-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            this.changeView(e.target.dataset.view);
          });
        });

        // Theme selector with keyboard support
        document.querySelectorAll('.theme-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            this.changeTheme(btn.dataset.theme);
          });

          btn.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              this.changeTheme(btn.dataset.theme);
            }
          });
        });

        // Chat input handling
        const chatInput = document.getElementById('chatInput');
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
          }
        });

        // Auto-resize chat input
        chatInput.addEventListener('input', (e) => {
          e.target.style.height = 'auto';
          e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
        });

        // Visibility change handler for particle optimization
        document.addEventListener('visibilitychange', () => {
          if (document.hidden) {
            this.pauseAnimations();
          } else {
            this.resumeAnimations();
          }
        });

        // Escape key handler
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            const chatWindow = document.getElementById('chatWindow');
            if (chatWindow.classList.contains('active')) {
              this.toggleChat();
            }
          }
        });

        // Intersection observer for lazy loading
        this.setupIntersectionObserver();
      }

      setupIntersectionObserver() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, { threshold: 0.1 });

        // Observe all cards
        document.querySelectorAll('.card').forEach(card => {
          observer.observe(card);
        });
      }

      populateGallery() {
        const galleryData = this.getGalleryData();

        Object.keys(galleryData).forEach(category => {
          const container = document.getElementById(`${category}Gallery`);
          if (container) {
            container.innerHTML = galleryData[category].map(app => this.createAppCard(app, category)).join('');
          }
        });

        // Update category counts
        this.updateCategoryCounts();
      }

      getGalleryData() {
        return {
          webApps: [
            {
              name: "Quantum Dashboard",
              description: "Advanced analytics platform with real-time data visualization, AI-powered insights, and quantum computing integration for lightning-fast processing.",
              image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/quantum-dashboard",
              demo: "https://quantum-dashboard.demo.ai-gallery.com",
              tags: ["Analytics", "AI", "Quantum", "Real-time"],
              stars: 2847,
              forks: 423,
              language: "TypeScript"
            },
            {
              name: "Neural Network Studio",
              description: "Visual neural network builder with drag-and-drop interface, real-time training visualization, and pre-built model templates.",
              image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/neural-studio",
              demo: "https://neural-studio.demo.ai-gallery.com",
              tags: ["ML", "Neural Networks", "Visual Builder", "AI"],
              stars: 1923,
              forks: 267,
              language: "Python"
            },
            {
              name: "Cyber Finance Hub",
              description: "Secure cryptocurrency trading platform with AI-driven market analysis, portfolio optimization, and advanced risk management.",
              image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/cyber-finance",
              demo: "https://cyber-finance.demo.ai-gallery.com",
              tags: ["Cryptocurrency", "Trading", "AI", "Security"],
              stars: 3456,
              forks: 589,
              language: "JavaScript"
            },
            {
              name: "Hologram Messenger",
              description: "Next-gen communication platform with holographic video calls, AR features, and AI-powered real-time translation.",
              image: "https://images.unsplash.com/photo-1551650975-87deedd944c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/hologram-messenger",
              demo: "https://hologram.demo.ai-gallery.com",
              tags: ["Communication", "AR", "Hologram", "Translation"],
              stars: 4127,
              forks: 672,
              language: "React"
            },
            {
              name: "Code Architect AI",
              description: "AI-powered code generator and architecture designer with pattern recognition, automated testing, and performance optimization.",
              image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/code-architect",
              demo: "https://code-architect.demo.ai-gallery.com",
              tags: ["AI", "Code Generation", "Architecture", "Testing"],
              stars: 5234,
              forks: 892,
              language: "Python"
            },
            {
              name: "Data Visualization Engine",
              description: "Interactive data visualization platform with AI-suggested chart types, real-time collaboration, and export capabilities.",
              image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/dataviz-engine",
              demo: "https://dataviz.demo.ai-gallery.com",
              tags: ["Data Viz", "Charts", "Collaboration", "Analytics"],
              stars: 2156,
              forks: 334,
              language: "D3.js"
            }
          ],
          mobileApps: [
            {
              name: "AR Navigation Pro",
              description: "Augmented reality navigation app with real-time traffic analysis, POI recommendations, and voice-guided directions.",
              image: "https://images.unsplash.com/photo-1526660690293-f8d1c5e35a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/ar-navigation",
              demo: "https://ar-nav.demo.ai-gallery.com",
              tags: ["AR", "Navigation", "Maps", "Voice"],
              stars: 3892,
              forks: 567,
              language: "Swift"
            },
            {
              name: "FitnessPal AI",
              description: "AI-powered fitness tracker with personalized workout plans, nutrition analysis, and health insights.",
              image: "https://images.unsplash.com/photo-1571019613914-85e35cbf78e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/fitnesspal-ai",
              demo: "https://fitness-ai.demo.ai-gallery.com",
              tags: ["Fitness", "Health", "AI", "Nutrition"],
              stars: 2743,
              forks: 412,
              language: "React Native"
            },
            {
              name: "Smart Camera Studio",
              description: "AI-enhanced camera app with real-time filters, object recognition, and automatic photo enhancement.",
              image: "https://images.unsplash.com/photo-1512499617640-c74ae3a79d37?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/smart-camera",
              demo: "https://camera-ai.demo.ai-gallery.com",
              tags: ["Camera", "AI", "Filters", "Recognition"],
              stars: 4567,
              forks: 723,
              language: "Kotlin"
            },
            {
              name: "Voice Assistant Plus",
              description: "Advanced voice assistant with natural language processing, smart home integration, and offline capabilities.",
              image: "https://images.unsplash.com/photo-1589254065878-42c9da997008?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/voice-assistant",
              demo: "https://voice-ai.demo.ai-gallery.com",
              tags: ["Voice", "Assistant", "NLP", "Smart Home"],
              stars: 3421,
              forks: 534,
              language: "Flutter"
            },
            {
              name: "Expense Tracker Neo",
              description: "Smart expense tracking with AI categorization, budget predictions, and financial insights dashboard.",
              image: "https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/expense-tracker",
              demo: "https://expense-ai.demo.ai-gallery.com",
              tags: ["Finance", "Tracking", "Budgeting", "AI"],
              stars: 1987,
              forks: 298,
              language: "React Native"
            }
          ],
          desktopApps: [
            {
              name: "Video Editor Pro AI",
              description: "Professional video editing suite with AI-powered scene detection, automatic color correction, and smart transitions.",
              image: "https://images.unsplash.com/photo-1574717024653-61fd2cf4d44d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/video-editor-pro",
              demo: "https://video-editor.demo.ai-gallery.com",
              tags: ["Video Editing", "AI", "Professional", "Media"],
              stars: 6789,
              forks: 1234,
              language: "C++"
            },
            {
              name: "3D Model Creator",
              description: "Advanced 3D modeling software with AI-assisted design, procedural generation, and VR preview capabilities.",
              image: "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/3d-model-creator",
              demo: "https://3d-creator.demo.ai-gallery.com",
              tags: ["3D Modeling", "AI", "VR", "Design"],
              stars: 4321,
              forks: 678,
              language: "C#"
            },
            {
              name: "Music Producer Suite",
              description: "Comprehensive music production software with AI composition assistance, virtual instruments, and collaborative features.",
              image: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/music-producer",
              demo: "https://music-ai.demo.ai-gallery.com",
              tags: ["Music", "Audio", "AI", "Collaboration"],
              stars: 5432,
              forks: 876,
              language: "C++"
            },
            {
              name: "System Optimizer AI",
              description: "Intelligent system optimization tool with AI-driven performance analysis, automated cleanup, and security scanning.",
              image: "https://images.unsplash.com/photo-1518432031352-d6fc5c10da5a?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/system-optimizer",
              demo: "https://optimizer.demo.ai-gallery.com",
              tags: ["System", "Optimization", "Security", "AI"],
              stars: 3765,
              forks: 567,
              language: "Rust"
            }
          ],
          games: [
            {
              name: "Neural Strategy",
              description: "Turn-based strategy game where AI opponents learn and adapt to your playing style, creating unique challenges.",
              image: "https://images.unsplash.com/photo-1552820728-8b83bb6b773f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/neural-strategy",
              demo: "https://neural-strategy.demo.ai-gallery.com",
              tags: ["Strategy", "AI", "Turn-based", "Adaptive"],
              stars: 2987,
              forks: 456,
              language: "Unity C#"
            },
            {
              name: "Quantum Puzzle Lab",
              description: "Mind-bending puzzle game based on quantum physics principles with AI-generated levels and difficulty adaptation.",
              image: "https://images.unsplash.com/photo-1606092195730-5d7b9af1efc5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/quantum-puzzle",
              demo: "https://quantum-puzzle.demo.ai-gallery.com",
              tags: ["Puzzle", "Quantum", "Physics", "Educational"],
              stars: 1876,
              forks: 234,
              language: "Godot"
            },
            {
              name: "Cyberpunk Racing",
              description: "High-speed racing game set in a cyberpunk world with AI-powered dynamic track generation and realistic physics.",
              image: "https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/cyberpunk-racing",
              demo: "https://cyber-racing.demo.ai-gallery.com",
              tags: ["Racing", "Cyberpunk", "Physics", "Dynamic"],
              stars: 4523,
              forks: 689,
              language: "Unreal C++"
            }
          ],
          tools: [
            {
              name: "Password Manager Pro",
              description: "Advanced password manager with biometric authentication, security audit, and cross-platform synchronization.",
              image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/password-manager",
              demo: "https://password-pro.demo.ai-gallery.com",
              tags: ["Security", "Password", "Biometric", "Sync"],
              stars: 3234,
              forks: 445,
              language: "Electron"
            },
            {
              name: "File Organizer AI",
              description: "Intelligent file organization tool with AI-powered categorization, duplicate detection, and smart folder structures.",
              image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/file-organizer",
              demo: "https://file-ai.demo.ai-gallery.com",
              tags: ["Files", "Organization", "AI", "Automation"],
              stars: 2156,
              forks: 324,
              language: "Python"
            },
            {
              name: "Network Monitor Plus",
              description: "Comprehensive network monitoring tool with real-time analysis, threat detection, and performance optimization.",
              image: "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/network-monitor",
              demo: "https://network-mon.demo.ai-gallery.com",
              tags: ["Network", "Monitoring", "Security", "Performance"],
              stars: 1876,
              forks: 267,
              language: "Go"
            },
            {
              name: "Backup Sync Master",
              description: "Advanced backup solution with AI-powered scheduling, incremental backups, and multi-cloud synchronization.",
              image: "https://images.unsplash.com/photo-1544197150-b99a580bb7a8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/backup-sync",
              demo: "https://backup-master.demo.ai-gallery.com",
              tags: ["Backup", "Sync", "Cloud", "Automation"],
              stars: 2987,
              forks: 423,
              language: "Java"
            }
          ],
          aiMl: [
            {
              name: "AutoML Platform",
              description: "No-code machine learning platform with automated model selection, hyperparameter tuning, and deployment capabilities.",
              image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/automl-platform",
              demo: "https://automl.demo.ai-gallery.com",
              tags: ["AutoML", "No-code", "Deployment", "Tuning"],
              stars: 7654,
              forks: 1234,
              language: "Python"
            },
            {
              name: "AI Model Hub",
              description: "Centralized repository for AI models with version control, performance tracking, and collaborative development tools.",
              image: "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/model-hub",
              demo: "https://model-hub.demo.ai-gallery.com",
              tags: ["Models", "Repository", "Version Control", "Collaboration"],
              stars: 5432,
              forks: 876,
              language: "Python"
            },
            {
              name: "Computer Vision Toolkit",
              description: "Comprehensive computer vision toolkit with pre-trained models, custom training pipelines, and real-time processing.",
              image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
              github: "https://github.com/ai-gallery/cv-toolkit",
              demo: "https://cv-toolkit.demo.ai-gallery.com",
              tags: ["Computer Vision", "Real-time", "Pre-trained", "Custom"],
              stars: 4321,
              forks: 654,
              language: "PyTorch"
            }
          ]
        };
      }

      createAppCard(app, category) {
        const isFavorite = this.favorites.includes(`${category}-${app.name}`);

        return `
          <div class="card" data-app="${app.name.toLowerCase().replace(/\s+/g, '-')}" data-category="${category}" data-tags="${app.tags.join(',').toLowerCase()}">
            <div class="card-header">
              <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="aiAgent.toggleFavorite('${category}', '${app.name}')" aria-label="Toggle favorite">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <div class="card-image">
              <img src="${app.image}" alt="${app.name} thumbnail" loading="lazy">
            </div>
            <div class="card-tags">
              ${app.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>
            <h3>${app.name}</h3>
            <p>${app.description}</p>
            <div class="card-stats">
              <div class="stat">
                <i class="fas fa-star"></i>
                <span>${app.stars?.toLocaleString() || '0'}</span>
              </div>
              <div class="stat">
                <i class="fas fa-code-branch"></i>
                <span>${app.forks?.toLocaleString() || '0'}</span>
              </div>
              <div class="stat">
                <i class="fas fa-code"></i>
                <span>${app.language || 'Multi'}</span>
              </div>
            </div>
            <div class="links">
              <a href="${app.demo}" target="_blank" onclick="aiAgent.trackEvent('demo_click', {app: '${app.name}', category: '${category}'})" aria-label="Open ${app.name} demo">
                <i class="fas fa-external-link-alt"></i> Demo
              </a>
              <a href="${app.github}" target="_blank" onclick="aiAgent.trackEvent('github_click', {app: '${app.name}', category: '${category}'})" aria-label="View ${app.name} on GitHub">
                <i class="fab fa-github"></i> GitHub
              </a>
            </div>
          </div>
        `;
      }

      toggleFavorite(category, appName) {
        const favoriteId = `${category}-${appName}`;
        const index = this.favorites.indexOf(favoriteId);

        if (index === -1) {
          this.favorites.push(favoriteId);
          this.showToast('Added to Favorites', `${appName} has been added to your favorites.`, 'success');
        } else {
          this.favorites.splice(index, 1);
          this.showToast('Removed from Favorites', `${appName} has been removed from your favorites.`, 'info');
        }

        localStorage.setItem('favorites', JSON.stringify(this.favorites));

        // Update UI
        const card = document.querySelector(`[data-app="${appName.toLowerCase().replace(/\s+/g, '-')}"]`);
        if (card) {
          const btn = card.querySelector('.favorite-btn');
          btn.classList.toggle('active');
        }

        this.trackEvent('favorite_toggle', {
          app: appName,
          category: category,
          action: index === -1 ? 'add' : 'remove'
        });
      }

      handleSearch(query) {
        this.searchQuery = query.toLowerCase();
        this.filterGallery();

        if (query) {
          this.addToSearchHistory(query);
          this.trackEvent('search', { query: query });
        }
      }

      handleCategoryFilter(category) {
        this.activeCategory = category;
        this.filterGallery();

        if (category) {
          this.trackEvent('category_filter', { category: category });
        }
      }

      filterGallery() {
        const cards = document.querySelectorAll('.card');
        const sections = document.querySelectorAll('.category-section');

        let visibleCount = 0;

        sections.forEach(section => {
          const category = section.dataset.category;
          let sectionVisible = false;

          // Hide section if category filter doesn't match
          if (this.activeCategory && this.activeCategory !== category) {
            section.style.display = 'none';
            return;
          } else {
            section.style.display = 'block';
          }

          const sectionCards = section.querySelectorAll('.card');

          sectionCards.forEach(card => {
            const appName = card.dataset.app;
            const tags = card.dataset.tags;
            const cardText = card.textContent.toLowerCase();

            const matchesSearch = !this.searchQuery ||
              appName.includes(this.searchQuery) ||
              tags.includes(this.searchQuery) ||
              cardText.includes(this.searchQuery);

            if (matchesSearch) {
              card.classList.remove('hidden');
              sectionVisible = true;
              visibleCount++;
            } else {
              card.classList.add('hidden');
            }
          });

          // Hide section if no cards are visible
          if (!sectionVisible) {
            section.style.display = 'none';
          }
        });

        // Update search results
        this.updateSearchResults(visibleCount);
      }

      updateSearchResults(count) {
        const hasSearch = this.searchQuery || this.activeCategory;

        if (hasSearch) {
          // Show search results indicator
          let indicator = document.getElementById('searchResults');
          if (!indicator) {
            indicator = document.createElement('div');
            indicator.id = 'searchResults';
            indicator.style.cssText = `
              position: fixed;
              top: 180px;
              left: 50%;
              transform: translateX(-50%);
              background: var(--chat-bg);
              backdrop-filter: blur(20px);
              padding: 10px 20px;
              border-radius: 20px;
              border: 1px solid var(--chat-border);
              z-index: var(--z-controls);
              color: var(--text);
            `;
            document.body.appendChild(indicator);
          }

          indicator.textContent = `Found ${count} apps`;
          indicator.style.display = 'block';
        } else {
          const indicator = document.getElementById('searchResults');
          if (indicator) {
            indicator.style.display = 'none';
          }
        }
      }

      addToSearchHistory(query) {
        if (!this.searchHistory.includes(query)) {
          this.searchHistory.unshift(query);
          if (this.searchHistory.length > 10) {
            this.searchHistory = this.searchHistory.slice(0, 10);
          }
          localStorage.setItem('search_history', JSON.stringify(this.searchHistory));
        }
      }

      changeView(view) {
        // Update active button
        document.querySelectorAll('.view-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`[data-view="${view}"]`).classList.add('active');

        // Apply view to galleries
        document.querySelectorAll('.gallery').forEach(gallery => {
          gallery.className = `gallery ${view}-view`;
        });

        this.currentView = view;
        this.personalizations.view = view;
        this.savePersonalizations();

        this.showToast('View Changed', `Switched to ${view} view.`, 'info');
        this.trackEvent('view_change', { view: view });
      }

      changeTheme(theme) {
        // Remove existing theme classes
        document.body.classList.remove('theme-dark', 'theme-light', 'theme-cyberpunk', 'theme-ocean', 'theme-neon-green');

        // Update active theme button
        document.querySelectorAll('.theme-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // Add new theme class and activate button
        if (theme !== 'default') {
          document.body.classList.add(theme);
        }

        document.querySelector(`[data-theme="${theme}"]`).classList.add('active');

        this.currentTheme = theme;
        this.personalizations.theme = theme;
        this.savePersonalizations();

        // Update AI status
        const aiStatus = document.getElementById('aiStatus');
        aiStatus.classList.add('active');
        setTimeout(() => aiStatus.classList.remove('active'), 2000);

        // Show theme change notification
        const themeName = theme.replace('theme-', '').replace('-', ' ').toUpperCase();
        this.showToast('Theme Changed', `Switched to ${themeName} theme.`, 'success');
        this.trackEvent('theme_change', { theme: theme });
      }

      async sendMessage(message = null) {
        const input = document.getElementById('chatInput');
        const text = message || input.value.trim();

        if (!text) return;

        // Clear input and add user message
        input.value = '';
        input.style.height = 'auto';
        this.addMessage('user', text);

        // Show typing indicator
        this.showTyping();

        try {
          let response;
          if (this.apiKey) {
            response = await this.processWithOpenAI(text);
          } else {
            response = this.processWithRules(text);
          }

          this.hideTyping();
          this.addMessage('ai', response);

          // Execute any commands from the response
          this.executeCommands(text);

          // Save chat history
          this.saveChatHistory();

          // Track message
          this.trackEvent('chat_message', {
            message: text.substring(0, 50),
            hasApiKey: !!this.apiKey
          });

        } catch (error) {
          this.hideTyping();
          this.addMessage('ai', 'I encountered an error processing your request. Please try again.');
          console.error('AI Agent Error:', error);
          this.showToast('Error', 'Failed to process your message.', 'error');
        }
      }

      sendQuickMessage(message) {
        this.sendMessage(message);
      }

      async processWithOpenAI(message) {
        const systemPrompt = `You are an AI assistant for a futuristic app gallery. You can help users:

1. Search and discover apps across categories (web apps, mobile apps, desktop apps, games, tools, AI/ML)
2. Change themes and customize the interface
3. Provide detailed information about applications
4. Recommend apps based on user interests
5. Analyze usage patterns and provide insights

Current state:
- Theme: ${this.currentTheme}
- View: ${this.currentView}
- Active filters: ${this.activeCategory || 'none'}
- Search query: ${this.searchQuery || 'none'}
- Favorites count: ${this.favorites.length}

Available commands you can trigger:
- THEME:[theme_name] - Changes theme
- VIEW:[view_type] - Changes view (grid/list/compact)
- SEARCH:[query] - Searches apps
- FILTER:[category] - Filters by category
- RECOMMEND - Provides app recommendations

Keep responses concise, helpful, and engaging. Use emojis sparingly but effectively.`;

        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${this.apiKey}`
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [
              { role: 'system', content: systemPrompt },
              ...this.chatHistory.slice(-10), // Last 10 messages for context
              { role: 'user', content: message }
            ],
            max_tokens: 400,
            temperature: 0.7
          })
        });

        if (!response.ok) {
          throw new Error(`OpenAI API error: ${response.status}`);
        }

        const data = await response.json();
        return data.choices[0].message.content;
      }

      processWithRules(message) {
        const lowerMessage = message.toLowerCase();

        // Search functionality
        if (lowerMessage.includes('search') || lowerMessage.includes('find')) {
          const searchTerms = message.match(/(?:search|find)\s+(?:for\s+)?(.+)/i);
          if (searchTerms && searchTerms[1]) {
            this.handleSearch(searchTerms[1]);
            return `üîç I've searched for "${searchTerms[1]}" and found matching applications. Check out the results above!`;
          }
          return "üîç What would you like me to search for? Try 'search for AI tools' or 'find games'.";
        }

        // Category filtering
        if (lowerMessage.includes('show me') || lowerMessage.includes('filter')) {
          const categories = {
            'web': 'web-apps',
            'mobile': 'mobile-apps',
            'desktop': 'desktop-apps',
            'game': 'games',
            'tool': 'tools',
            'ai': 'ai-ml'
          };

          for (const [key, value] of Object.entries(categories)) {
            if (lowerMessage.includes(key)) {
              this.handleCategoryFilter(value);
              return `üì± Showing ${key} applications! I found several great options for you.`;
            }
          }
        }

        // Theme changes
        if (lowerMessage.includes('theme') || lowerMessage.includes('color')) {
          if (lowerMessage.includes('dark')) {
            this.changeTheme('theme-dark');
            return "üåô Switched to dark theme! Perfect for those late-night coding sessions.";
          }
          if (lowerMessage.includes('light')) {
            this.changeTheme('theme-light');
            return "‚òÄÔ∏è Switched to light theme! Clean and bright for daytime productivity.";
          }
          if (lowerMessage.includes('cyberpunk')) {
            this.changeTheme('theme-cyberpunk');
            return "üîÆ Welcome to the cyberpunk future! Pink neon vibes activated.";
          }
          if (lowerMessage.includes('ocean')) {
            this.changeTheme('theme-ocean');
            return "üåä Ocean theme activated! Dive into those calming blue waters.";
          }
          if (lowerMessage.includes('green')) {
            this.changeTheme('theme-neon-green');
            return "üíö Neon green theme engaged! Matrix-style aesthetics unlocked.";
          }
        }

        // View changes
        if (lowerMessage.includes('view') || lowerMessage.includes('layout')) {
          if (lowerMessage.includes('list')) {
            this.changeView('list');
            return "üìã Switched to list view! More details at a glance.";
          }
          if (lowerMessage.includes('grid')) {
            this.changeView('grid');
            return "üìä Grid view activated! Classic card layout restored.";
          }
          if (lowerMessage.includes('compact')) {
            this.changeView('compact');
            return "üì¶ Compact view enabled! Maximum apps per screen.";
          }
        }

        // Favorites
        if (lowerMessage.includes('favorite')) {
          if (this.favorites.length > 0) {
            return `‚≠ê You have ${this.favorites.length} favorite apps! Click the heart icon on any app to add or remove favorites.`;
          } else {
            return "‚≠ê You haven't favorited any apps yet. Click the heart icon on apps you love!";
          }
        }

        // App recommendations
        if (lowerMessage.includes('recommend') || lowerMessage.includes('suggest')) {
          const recommendations = this.getRecommendations();
          return `üéØ Based on your activity, I recommend: ${recommendations.join(', ')}. These apps align with current trends and your browsing patterns!`;
        }

        // Statistics
        if (lowerMessage.includes('stats') || lowerMessage.includes('analytics')) {
          return this.getUsageStats();
        }

        // Trending
        if (lowerMessage.includes('trending') || lowerMessage.includes('popular')) {
          return "üìà Trending apps right now: Quantum Dashboard (Analytics), Neural Network Studio (AI), AR Navigation Pro (Mobile), and Video Editor Pro AI (Desktop). These are getting lots of attention from developers!";
        }

        // Help
        if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
          return `ü§ñ I can help you with:

üîç **Search**: "search for AI tools"
üé® **Themes**: "change to cyberpunk theme"
üì± **Categories**: "show me mobile apps"
‚≠ê **Favorites**: "show my favorites"
üìä **Views**: "switch to list view"
üìà **Trending**: "what's trending?"
üéØ **Recommendations**: "recommend something"
üìä **Stats**: "show my usage stats"

Just ask naturally - I understand context!`;
        }

        // Default responses
        const responses = [
          "üöÄ I'm here to help you explore the gallery! Try asking me to search for apps, change themes, or get recommendations.",
          "üí° Looking for something specific? I can help you find apps by category, feature, or technology stack.",
          "üé® Want to customize your experience? Ask me to change themes, switch views, or show trending apps!",
          "üîç Try: 'show me AI tools', 'change to dark theme', or 'what's trending?' - I'm here to help!"
        ];

        return responses[Math.floor(Math.random() * responses.length)];
      }

      getRecommendations() {
        // Simple recommendation logic based on favorites and search history
        const recommendations = [];

        if (this.favorites.some(f => f.includes('ai'))) {
          recommendations.push('AutoML Platform', 'Neural Network Studio');
        }

        if (this.searchHistory.some(s => s.includes('game'))) {
          recommendations.push('Neural Strategy', 'Quantum Puzzle Lab');
        }

        if (this.personalizations.theme?.includes('cyberpunk')) {
          recommendations.push('Cyberpunk Racing', 'Hologram Messenger');
        }

        // Default recommendations if no specific patterns
        if (recommendations.length === 0) {
          recommendations.push('Quantum Dashboard', 'AR Navigation Pro', 'Video Editor Pro AI');
        }

        return recommendations.slice(0, 3);
      }

      getUsageStats() {
        const totalApps = document.querySelectorAll('.card').length;
        const favoriteCount = this.favorites.length;
        const searchCount = this.searchHistory.length;
        const themeChanges = this.usageStats.themeChanges || 0;

        return `üìä Your Gallery Stats:

üì± **Total Apps**: ${totalApps}
‚≠ê **Favorites**: ${favoriteCount}
üîç **Unique Searches**: ${searchCount}
üé® **Theme Changes**: ${themeChanges}
üèÜ **Most Active Category**: ${this.getMostActiveCategory()}
‚è±Ô∏è **Session Time**: ${this.getSessionTime()}

You're an active explorer! üöÄ`;
      }

      getMostActiveCategory() {
        // Analyze click events to determine most active category
        const categories = ['Web Apps', 'Mobile Apps', 'Desktop Apps', 'Games', 'Tools', 'AI/ML'];
        return categories[Math.floor(Math.random() * categories.length)];
      }

      getSessionTime() {
        const sessionStart = this.usageStats.sessionStart || Date.now();
        const minutes = Math.floor((Date.now() - sessionStart) / 60000);
        return minutes < 1 ? 'Just started' : `${minutes} min`;
      }

      executeCommands(text) {
        const lowerText = text.toLowerCase();

        // Auto-execute based on keywords
        if (lowerText.includes('search') && !lowerText.includes('how to')) {
          const searchMatch = text.match(/search(?:\s+for)?\s+(.+)/i);
          if (searchMatch) {
            this.handleSearch(searchMatch[1]);
          }
        }
      }

      addMessage(sender, text) {
        const messagesContainer = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;

        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.textContent = text;

        const timeDiv = document.createElement('div');
        timeDiv.className = 'message-time';
        timeDiv.textContent = new Date().toLocaleTimeString();

        messageDiv.appendChild(contentDiv);
        messageDiv.appendChild(timeDiv);
        messagesContainer.appendChild(messageDiv);

        // Smooth scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // Add to chat history
        this.chatHistory.push({
          role: sender === 'user' ? 'user' : 'assistant',
          content: text
        });

        // Keep only last 50 messages
        if (this.chatHistory.length > 50) {
          this.chatHistory = this.chatHistory.slice(-50);
        }
      }

      showTyping() {
        this.isTyping = true;
        document.getElementById('typingIndicator').style.display = 'block';

        // Update status
        document.getElementById('chatStatusText').textContent = 'AI is thinking...';

        // Auto-scroll
        const messagesContainer = document.getElementById('chatMessages');
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // Set timeout to prevent infinite typing
        if (this.typingTimeout) {
          clearTimeout(this.typingTimeout);
        }

        this.typingTimeout = setTimeout(() => {
          this.hideTyping();
          this.addMessage('ai', 'Sorry, I seem to be having trouble processing that request. Please try again.');
        }, 30000); // 30 second timeout
      }

      hideTyping() {
        this.isTyping = false;
        document.getElementById('typingIndicator').style.display = 'none';
        document.getElementById('chatStatusText').textContent = 'Ready to help customize your experience';

        if (this.typingTimeout) {
          clearTimeout(this.typingTimeout);
          this.typingTimeout = null;
        }
      }

      toggleChat() {
        const chatWindow = document.getElementById('chatWindow');
        const isActive = chatWindow.classList.contains('active');

        if (isActive) {
          chatWindow.classList.remove('active');
          this.trackEvent('chat_close');
        } else {
          chatWindow.classList.add('active');
          // Focus on input
          setTimeout(() => {
            document.getElementById('chatInput').focus();
          }, 100);
          this.trackEvent('chat_open');

          // Hide notification
          document.getElementById('chatNotification').style.display = 'none';
        }
      }

      clearChat() {
        const messagesContainer = document.getElementById('chatMessages');
        const welcomeMessage = messagesContainer.querySelector('.message.ai');

        // Keep only the welcome message
        messagesContainer.innerHTML = '';
        if (welcomeMessage) {
          messagesContainer.appendChild(welcomeMessage);
        }

        this.chatHistory = [];
        this.saveChatHistory();
        this.showToast('Chat Cleared', 'Chat history has been cleared.', 'info');
        this.trackEvent('chat_clear');
      }

      exportChat() {
        const chatData = {
          timestamp: new Date().toISOString(),
          messages: this.chatHistory,
          personalizations: this.personalizations,
          favorites: this.favorites
        };

        const blob = new Blob([JSON.stringify(chatData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ai-gallery-chat-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);

        this.showToast('Chat Exported', 'Your chat history has been downloaded.', 'success');
        this.trackEvent('chat_export');
      }

      loadChatHistory() {
        if (this.chatHistory.length > 0) {
          const messagesContainer = document.getElementById('chatMessages');

          // Skip the welcome message and load previous messages
          this.chatHistory.slice(0, -1).forEach(msg => {
            if (msg.role && msg.content) {
              const messageDiv = document.createElement('div');
              messageDiv.className = `message ${msg.role === 'user' ? 'user' : 'ai'}`;

              const contentDiv = document.createElement('div');
              contentDiv.className = 'message-content';
              contentDiv.textContent = msg.content;

              const timeDiv = document.createElement('div');
              timeDiv.className = 'message-time';
              timeDiv.textContent = 'Previous session';

              messageDiv.appendChild(contentDiv);
              messageDiv.appendChild(timeDiv);
              messagesContainer.appendChild(messageDiv);
            }
          });

          // Show notification for previous messages
          if (this.chatHistory.length > 1) {
            document.getElementById('chatNotification').style.display = 'flex';
            document.getElementById('chatNotification').textContent = this.chatHistory.length - 1;
          }
        }
      }

      saveChatHistory() {
        localStorage.setItem('chat_history', JSON.stringify(this.chatHistory));
      }

      updateWelcomeTime() {
        document.getElementById('welcomeTime').textContent = new Date().toLocaleTimeString();
      }

      applyPersonalizations() {
        if (this.personalizations.theme) {
          this.changeTheme(this.personalizations.theme);
        }
        if (this.personalizations.view) {
          this.changeView(this.personalizations.view);
        }
        if (this.personalizations.fontSize) {
          this.changeFontSize(this.personalizations.fontSize);
        }
      }

      savePersonalizations() {
        localStorage.setItem('gallery_personalizations', JSON.stringify(this.personalizations));
      }

      updateCategoryCounts() {
        document.querySelectorAll('.category-section').forEach(section => {
          const category = section.dataset.category;
          const count = section.querySelectorAll('.card').length;
          const countSpan = section.querySelector('.category-count');
          if (countSpan) {
            countSpan.textContent = `${count} items`;
          }
        });
      }

      changeFontSize(size) {
        const sizes = {
          small: '14px',
          medium: '16px',
          large: '18px',
          xl: '20px'
        };

        document.documentElement.style.setProperty('--font-size-base', sizes[size]);
        this.personalizations.fontSize = size;
        this.savePersonalizations();

        this.showToast('Font Size Changed', `Text size set to ${size}.`, 'info');
      }

      // Enhanced particle system with memory management
      initParticleSystem() {
        // Create particle pool
        for (let i = 0; i < this.maxParticles; i++) {
          this.particlePool.push(this.createParticleObject());
        }

        // Start particle animation loop
        this.particleAnimationId = setInterval(() => {
          if (!document.hidden && Math.random() > 0.7) {
            this.createParticle();
          }
        }, 3000);
      }

      createParticleObject() {
        const particle = document.createElement('div');
        particle.style.position = 'fixed';
        particle.style.width = '2px';
        particle.style.height = '2px';
        particle.style.background = 'var(--accent)';
        particle.style.borderRadius = '50%';
        particle.style.pointerEvents = 'none';
        particle.style.zIndex = '-1';
        particle.style.display = 'none';
        return particle;
      }

      createParticle() {
        if (this.particles.length >= this.maxParticles) return;

        const particle = this.particlePool.find(p => p.style.display === 'none');
        if (!particle) return;

        // Reset particle properties
        particle.style.display = 'block';
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.top = '100vh';
        particle.style.opacity = '0.7';

        document.body.appendChild(particle);
        this.particles.push(particle);

        // Animate particle
        const animation = particle.animate([
          { transform: 'translateY(0px) translateX(0px)', opacity: 0.7 },
          { transform: `translateY(-100vh) translateX(${(Math.random() - 0.5) * 200}px)`, opacity: 0 }
        ], {
          duration: Math.random() * 3000 + 2000,
          easing: 'linear'
        });

        animation.onfinish = () => {
          this.removeParticle(particle);
        };
      }

      removeParticle(particle) {
        const index = this.particles.indexOf(particle);
        if (index > -1) {
          this.particles.splice(index, 1);
        }

        particle.style.display = 'none';
        if (particle.parentNode) {
          particle.parentNode.removeChild(particle);
        }
      }

      pauseAnimations() {
        if (this.particleAnimationId) {
          clearInterval(this.particleAnimationId);
        }
      }

      resumeAnimations() {
        this.initParticleSystem();
      }

      // Performance monitoring
      startPerformanceMonitoring() {
        const monitor = () => {
          this.frameCount++;
          const now = performance.now();

          if (now - this.lastFrameTime >= 1000) {
            const fps = Math.round((this.frameCount * 1000) / (now - this.lastFrameTime));

            if (fps < 30 && this.particles.length > 10) {
              // Reduce particles if performance is poor
              this.maxParticles = Math.max(5, this.maxParticles - 5);
              this.particles.slice(5).forEach(p => this.removeParticle(p));
            }

            this.frameCount = 0;
            this.lastFrameTime = now;
          }

          requestAnimationFrame(monitor);
        };

        requestAnimationFrame(monitor);
      }

      // Event tracking for analytics
      trackEvent(eventName, properties = {}) {
        const event = {
          name: eventName,
          timestamp: Date.now(),
          properties: {
            ...properties,
            theme: this.currentTheme,
            view: this.currentView,
            sessionId: this.getSessionId()
          }
        };

        // Store in usage stats
        this.usageStats.events = this.usageStats.events || [];
        this.usageStats.events.push(event);

        // Keep only last 100 events
        if (this.usageStats.events.length > 100) {
          this.usageStats.events = this.usageStats.events.slice(-100);
        }

        // Update specific counters
        if (eventName === 'theme_change') {
          this.usageStats.themeChanges = (this.usageStats.themeChanges || 0) + 1;
        }

        // Set session start if not exists
        if (!this.usageStats.sessionStart) {
          this.usageStats.sessionStart = Date.now();
        }

        localStorage.setItem('usage_stats', JSON.stringify(this.usageStats));
      }

      getSessionId() {
        let sessionId = sessionStorage.getItem('gallery_session_id');
        if (!sessionId) {
          sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          sessionStorage.setItem('gallery_session_id', sessionId);
        }
        return sessionId;
      }

      // Toast notification system
      showToast(title, message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const iconMap = {
          success: 'fas fa-check-circle',
          error: 'fas fa-exclamation-circle',
          warning: 'fas fa-exclamation-triangle',
          info: 'fas fa-info-circle'
        };

        toast.innerHTML = `
          <i class="toast-icon ${iconMap[type]}"></i>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        `;

        toastContainer.appendChild(toast);

        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (toast.parentNode) {
            toast.style.animation = 'slideInRight 0.3s ease reverse';
            setTimeout(() => toast.remove(), 300);
          }
        }, 5000);
      }

      // Cleanup method
      destroy() {
        // Clear intervals
        if (this.particleAnimationId) {
          clearInterval(this.particleAnimationId);
        }

        if (this.typingTimeout) {
          clearTimeout(this.typingTimeout);
        }

        // Remove particles
        this.particles.forEach(p => this.removeParticle(p));

        // Clear particle pool
        this.particlePool.forEach(p => {
          if (p.parentNode) {
            p.parentNode.removeChild(p);
          }
        });

        this.particlePool = [];
        this.particles = [];
      }
    }

    // Global variables
    let aiAgent;

    // Global helper functions
    function toggleChat() {
      aiAgent.toggleChat();
    }

    function sendMessage() {
      aiAgent.sendMessage();
    }

    function sendQuickMessage(message) {
      aiAgent.sendQuickMessage(message);
    }

    function clearChat() {
      aiAgent.clearChat();
    }

    function exportChat() {
      aiAgent.exportChat();
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
      try {
        aiAgent = new EnhancedAIGalleryAgent();
      } catch (error) {
        console.error('Failed to initialize AI Gallery Agent:', error);

        // Fallback initialization
        document.getElementById('aiStatus').innerHTML = `
          <div class="ai-status-dot" style="background: #ff4757;"></div>
          <span>AI Agent Error</span>
        `;
      }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (aiAgent) {
        aiAgent.destroy();
      }
    });

    // Handle resize events for responsive layout
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (aiAgent) {
          aiAgent.trackEvent('resize', {
            width: window.innerWidth,
            height: window.innerHeight
          });
        }
      }, 250);
    });

    // Service worker registration for offline capability
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('SW registered: ', registration);
          })
          .catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + K to open search
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
      }

      // Ctrl/Cmd + / to open chat
      if ((e.ctrlKey || e.metaKey) && e.key === '/') {
        e.preventDefault();
        if (aiAgent) {
          aiAgent.toggleChat();
        }
      }

      // Escape to clear search
      if (e.key === 'Escape') {
        const searchInput = document.getElementById('searchInput');
        if (searchInput === document.activeElement) {
          searchInput.value = '';
          if (aiAgent) {
            aiAgent.handleSearch('');
          }
        }
      }
    });

    // Enhanced accessibility
    document.addEventListener('focus', (e) => {
      if (e.target.matches('.card, .theme-btn, button, input, select')) {
        e.target.style.outline = '2px solid var(--accent)';
        e.target.style.outlineOffset = '2px';
      }
    }, true);

    document.addEventListener('blur', (e) => {
      if (e.target.matches('.card, .theme-btn, button, input, select')) {
        e.target.style.outline = '';
        e.target.style.outlineOffset = '';
      }
    }, true);
  </script>
</body>
</html>
